\copy (SELECT locations.tiploc,schedules.category,schedules.power_type,schedules.timing_load,schedules.atoc_code,flat_timing.arrival_scheduled, to_timestamp(flat_timing.arrival_scheduled) FROM flat_timing INNER JOIN schedule_locations ON schedule_locations.iid=flat_timing.schedule_location_iid INNER JOIN schedules ON schedule_locations.schedule_iid=schedules.iid INNER JOIN locations ON schedule_locations.location_iid=locations.iid WHERE schedule_locations.activity LIKE '%TF%' AND schedules.category IN ('XX', 'XC', 'XZ', 'XC', 'OL', 'OU', 'OO', 'OW') AND locations.tiploc IN ('BLFR', 'CANONST', 'CHRX', 'EUSTON', 'FENCHRS', 'KNGX', 'LIVST', 'LNDNBDC', 'LNDNBDE', 'LNDNBDG', 'MRGT', 'PADTON', 'STPXBOX', 'STPANCI', 'STPX', 'VICTRIC', 'VICTRIA', 'VICTRIE', 'WATRLMN', 'MARYLBN') AND schedules.operating_characteristics NOT LIKE '%Q%' AND flat_timing.arrival_scheduled BETWEEN 1550736000 AND 1550739600 ORDER BY tiploc ASC, arrival_scheduled ASC) to '/tmp/rushhourdata.csv' with CSV;
